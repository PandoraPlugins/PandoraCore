package dev.minecraftplugin.pandoracore.patch.patches.exploit;

import dev.minecraftplugin.pandoracore.PandoraCore;
import dev.minecraftplugin.pandoracore.patch.Patch;
import net.minecraft.server.v1_8_R3.Packet;
import org.bukkit.ChatColor;
import org.bukkit.Location;
import org.bukkit.WorldBorder;
import org.bukkit.event.EventHandler;
import org.bukkit.event.player.PlayerTeleportEvent;

public class PearlOutOfBorderPatch extends Patch<Packet<?>> {

    public PearlOutOfBorderPatch(){
        super("PearlOutOfBorderPatch", "Prevents players from pearling outside of the world border",
                false, false, null, true);
    }

    @EventHandler
    public void onPlayerTeleportFromPearl(PlayerTeleportEvent event){

        if(event.getCause() == PlayerTeleportEvent.TeleportCause.ENDER_PEARL){

            if(isOutsideBorder(event.getTo())){
                event.setCancelled(true);
                event.getPlayer().sendMessage(ChatColor.RED+"You have reached the edge of this world");
            }
            
        }

    }

    public static boolean isOutsideBorder(Location loc) {
        WorldBorder border = loc.getWorld().getWorldBorder();
        double size = border.getSize()/2;
        Location center = border.getCenter();
        double x = loc.getX() - center.getX(), z = loc.getZ() - center.getZ();
        return ((x > size || (-x) > size) || (z > size || (-z) > size));
    }

    @Override
    public void enable(PandoraCore core) {

    }

    @Override
    public void disable(PandoraCore core) {

    }
}
